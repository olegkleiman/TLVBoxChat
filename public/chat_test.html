<!DOCTYPE html> 
<html> 
  
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, user-scalable=yes">
        <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
        <meta http-equiv="Pragma" content="no-cache" />
        <meta http-equiv="Expires" content="0" />
        <meta charset="UTF-8" />
        <title>עוזרת אישית - עיריית ת"א</title>
        <link rel="shortcut icon" type="image/png" sizes="32x32" href="https://www.tel-aviv.gov.il/_layouts/15/TlvSP2013PublicSite/Images/IriaFavIcon.ico" />
    </head>

    <body>
        <button id="record" class="message-mic" onclick="openMicrophone()">
            <img alt="microphone" id="mic_img" style="border:none;" width="32" height="32" 
                src="https://www.google.com/intl/en/chrome/assets/common/images/content/mic.gif" />
        </button>

        <button onclick="playAudio('שָׁלוֹם, אֲנִי הָעוֹזֶרֶת הָאִישִּׁית. אפשר לשאול אותי על כל דבר שקורה בעיר תל-אביב. איך אוכל לסייע?')">
            <span>Play</span>
        </button>

        <script src="./scripts/audio.js"></script>     

        <script>
            
                const recognition = new (window.webkitSpeechRecognition ||
                window.mozSpeechRecognition ||
                window.msSpeechRecognition)();

                recognition.lang = 'he-IL';
                recognition.continuous = false; // when the user stops talking, speech recognition will end.
                recognition.interimResults = false; // only results returned by the recognizer are final and will not change. 
                recognition.onstart = () => {
                    console.log("Speech recognition started");
                }
                recognition.onend = () => {
                    console.log("Speech recognition ended");
                }
                recognition.onspeechend = () => {
                    console.log("Speech ended");
                    recognition.stop();
                };      
                recognition.onnomatch = (event) => {
                    console.error("I didn't recognize your speech.");
                }; 
                recognition.onerror = (event) => {
                    console.error(`Error occurred while transcribing audio: ${event.error}`);
                }
                recognition.onresult = (event) => {
                    stopRecording();

                    const transcript = event.results[0][0].transcript;
                    console.log(`Transcript: ${transcript}`);
                }                
        </script>
    </body>
</html>