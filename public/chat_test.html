<!DOCTYPE html>
<html class="no-js consumer" lang="en">
  <head>

    <meta charset="utf-8">
    <meta content="initial-scale=1, minimum-scale=1, width=device-width" name="viewport">
    <title>עוזרת אישית - עיריית ת"א</title>
    <link rel="shortcut icon" type="image/png" sizes="32x32" href="https://www.tel-aviv.gov.il/_layouts/15/TlvSP2013PublicSite/Images/IriaFavIcon.ico" />
    <link href="https://www.google.com/intl/en/chrome/assets/common/css/chrome.min.css" rel="stylesheet" nonce="JGH9Qvc6nBgAAO3frL9QRQ">
    
    <style>
    
        #info {
            font-size: 20px;
        }

        #div_start {
            float: right;
        }
        #headline {
            text-decoration: none
        }
        #results {
            font-size: 14px;
            font-weight: bold;
            border: 1px solid #ddd;
            padding: 15px;
            text-align: left;
            min-height: 150px;
        }
        #start_button {
            border: 0;
            background-color:transparent;
            padding: 0;
        }
        .interim {
            color: gray;
        }
        .final {
            color: black;
            padding-right: 3px;
        }
        .button {
            display: none;
        }
        .marquee {
            margin: 20px auto;
        }

        #buttons {
            margin: 10px 0;
            position: relative;
            top: -50px;
        }
        #copy {
            margin-top: 20px;
        }

        #copy > div {
            display: none;
            margin: 0 70px;
        }
    </style>
    <style>
        a.c1 {font-weight: normal;}
    </style>
  </head>
  <body class="" id="grid">
    <div class="browser-landing" id="main">
      <div class="compact marquee-stacked" id="marquee">
        <div class="marquee-copy">
          <h1>
            <a class="c1" href="https://webaudio.github.io/web-speech-api/">Web Speech API</a> Demonstration
          </h1>
        </div>
      </div>
      <div class="compact marquee">
        <div id="info">
          <p id="info_start">
            Click on the microphone icon and begin speaking for as long as you like.
          </p>
          <p id="info_speak_now" style="display:none">
            Speak now.
          </p>
          <p id="info_no_speech" style="display:none">
            No speech was detected. You may need to adjust your <a href=
            "//support.google.com/chrome/bin/answer.py?hl=en&amp;answer=1407892">microphone
            settings</a>.
          </p>
          <p id="info_no_microphone" style="display:none">
            No microphone was found. Ensure that a microphone is installed and that
            <a href="//support.google.com/chrome/bin/answer.py?hl=en&amp;answer=1407892">
            microphone settings</a> are configured correctly.
          </p>
          <p id="info_allow" style="display:none">
            Click the "Allow" button above to enable your microphone.
          </p>
          <p id="info_denied" style="display:none">
            Permission to use microphone was denied.
          </p>
          <p id="info_blocked" style="display:none">
            Permission to use microphone is blocked. To change, go to
            chrome://settings/contentExceptions#media-stream
          </p>
        </div>
        <div id="div_start">
          <button id="start_button" onclick="startButton(event)"><img alt="Start" id="start_img"
          src="https://www.google.com/intl/en/chrome/assets/common/images/content/mic.gif"></button>
        </div>
        <div id="results">
          <div class="final" id="final_span"></div> 
          <div class="interim" id="interim_span"></div>
        </div>
      </div>
    </div>
    <script src="https://www.google.com/intl/en/chrome/assets/common/js/chrome.min.js"></script> 

    <script>

        var final_transcript = '';
        var recognizing = false;
        if( 'webkitSpeechRecognition' in window ) {

            start_button.style.display = 'inline-block';
            recognition = new (window.webkitSpeechRecognition || 
            window.webkitSpeechRecognition ||
            window.mozSpeechRecognition ||
            window.msSpeechRecognition)();

            recognition.onstart = () => {
                recognizing = true;
                start_img.src = 'https://www.google.com/intl/en/chrome/assets/common/images/content/mic-animate.gif';
            };

            recognition.onerror = (event) => {
                console.log(event.error);
                start_img.src = 'https://www.google.com/intl/en/chrome/assets/common/images/content/mic.gif';
            };

            recognition.onend = () => {
                recognizing = false;
                start_img.src = 'https://www.google.com/intl/en/chrome/assets/common/images/content/mic.gif';
            };

            recognition.onresult = (event) => {

                var interim_transcript = '';
                if (typeof(event.results) == 'undefined') {
                    recognition.onend = null;
                    recognition.stop();
                    return;
                }
                for (var i = event.resultIndex; i < event.results.length; ++i) {
                    if (event.results[i].isFinal) {
                        final_transcript += event.results[i][0].transcript;
                        speak(final_transcript)
                    } else {
                        interim_transcript += event.results[i][0].transcript;
                    }
                }

                final_span.innerHTML = final_transcript;
                console.log(`Final transcript: ${final_transcript}`)
                interim_span.innerHTML = interim_transcript;
                console.log(`Logging interim transcript: ${interim_transcript}`)
            };
    }

    function startButton(event) {
        if (recognizing) {
            recognition.stop();
            return;
        }
        
        final_transcript = '';
        recognition.lang = 'he-IL'
        recognition.start();
        ignore_onend = false;
        final_span.innerHTML = '';
        interim_span.innerHTML = '';
        start_img.src = 'https://www.google.com/intl/en/chrome/assets/common/images/content/mic-slash.gif';
    }

    function speak(text) {
        
        if ('speechSynthesis' in window) {
            
            const speechSynthesis = window.speechSynthesis;

            let utterance = new SpeechSynthesisUtterance(text);
            utterance.pitch = 1;
            utterance.rate = 1;

            const voices = speechSynthesis.getVoices().filter(voice => voice.lang === 'he-IL');

            utterance.voice = voices[0];
            speechSynthesis.speak(utterance)
        }
        else 
            console.error(`speechSynthesis is not supported!`);
    }
    </script>
  </body>
</html>
